# 进程管理

**什么是进程，什么是线程，它们的区别是什么？**

进程：进程是运行中的程序的实例，是系统资源分配的基本单位，每个进程由一个或多个线程组成。

线程：线程通常称为轻量级进程，是操作系统进行CPU调度的基本单位，同一个进程内的所有线程共享该进程中的资源。

区别：

- 进程是资源（包括内存、打开的文件等）分配的单位，线程是 CPU 调度的单位；
- 进程拥有一个完整的资源平台，而线程只独享必不可少的资源，如寄存器和栈；
- 线程同样具有就绪、阻塞、执行三种基本状态，同样具有状态之间的转换关系；
- 线程能减少并发执行的时间和空间开销；
- 线程的上下文切换相比进程，开销要小很多。



**进程之间的通信方式**

1、管道

管道是进程间的通信方式，它是一种特殊的文件，两个进程之间可以通过管道进行传递数据，是无格式的字节流数据；管道分为匿名管道和命名管道。

- 匿名管道：匿名管道只能用于父子进程之间进行通信，其只能进行单向传输，因此需要进行双向传输的话需要创建两个管道。
- 命名管道：命名管道**它可以在不相关的进程间也能相互通信**。因为命令管道，提前创建了一个类型为管道的设备文件，在进程里只要使用这个设备文件，就可以相互通信。

不管是匿名管道还是命名管道，进程写入的数据都是缓存在内核中，另一个进程读取数据时候自然也是从内核中获取，同时通信数据都遵循**先进先出**原则，因此管道的通信效率是比较低的，因此管道不适合进程间频繁地交换数据。

2、消息队列

消息队列是保存在内核中的消息链表，在发送数据时，会分成一个一个独立的数据单元，也就是消息体（数据块），消息体是用户自定义的数据类型，**消息的发送方和接收方要约定好消息体的数据类型**，所以每个消息体都是固定大小的存储块，不像管道是无格式的字节流数据。如果进程从消息队列中读取了消息体，内核就会把这个消息体删除。

消息队列的缺点：

- 通信不及时

- **消息队列不适合比较大数据的传输**，因为在内核中每个消息体都有一个最大长度的限制
- **消息队列通信过程中，存在用户态与内核态之间的数据拷贝开销**，因为进程写入数据到内核中的消息队列时，会发生从用户态拷贝数据到内核态的过程

3、共享内存

**共享内存的机制，就是拿出一块虚拟地址空间来，映射到相同的物理内存中**。这样这个进程写入的东西，另外一个进程马上就能看到了，都不需要拷贝来拷贝去，传来传去，大大提高了进程间通信的速度。

4、信号量

信号量就是为了防止在共享内存时，由于多进程竞争共享内存，而造成数据错乱，引进的一种保护机制，它可以使得共享的资源在任意时刻只能被一个进程访问。

5、信号

信号是进程间通信机制中**唯一的异步通信机制**，因为可以在任何时候发送信号给某一进程，一旦有信号产生，我们就有下面这几种，用户进程对信号的处理方式。

- **执行默认操作**。Linux 对每种信号都规定了默认操作，例如，上面列表中的 SIGTERM 信号，就是终止进程的意思。
- **捕捉信号**。我们可以为信号定义一个信号处理函数。当信号发生时，我们就执行相应的信号处理函数。
- **忽略信号**。当我们不希望处理某些信号的时候，就可以忽略该信号，不做任何处理。有两个信号是应用进程无法捕捉和忽略的，即 `SIGKILL` 和 `SEGSTOP`，它们用于在任何时候中断或结束某一进程。

6、socket

Socket 通信可以实现跨网络与不同主机的进程间通信。



**进程同步方式有哪些？**

进程同步方式主要有以下几种方式：

1、锁

使用加锁操作和解锁操作可以解决并发线程/进程的互斥问题。任何想进入临界区的线程，必须先执行加锁操作。若加锁操作顺利通过，则线程可进入临界区；在完成对临界资源的访问后再执行解锁操作，以释放该临界资源。

2、信号量

用来同步多个进程对共享资源的访问。进程需要对信号量进行P（对信号量减1）和V（对信号量加1）等操作才能对资源进行访问。



**锁的类型有哪些？**

根据锁的实现不同，可以分为「忙等待锁」和「无忙等待锁」。

- 当获取不到锁时，线程就会一直 while 循环，不做任何事情，所以就被称为「忙等待锁」，也被称为**自旋锁（\*spin lock\*）**。

- 无等待锁顾明思议就是获取不到锁的时候，不用自旋。

  既然不想自旋，那当没获取到锁的时候，就把当前线程放入到锁的等待队列，然后执行调度程序，把 CPU 让给其他线程执行。



